#!/bin/env perl
$fname0   = 'functions.in.c';
@nctypes  = ('NC_BYTE', 'NC_UBYTE', 'NC_CHAR', 'NC_SHORT', 'NC_USHORT', 'NC_INT', 'NC_UINT',
	     'NC_INT64', 'NC_UINT64', 'NC_FLOAT', 'NC_DOUBLE');
@formats  = ('hhi', 'hhu', 'c', 'hi', 'hu', 'i', 'u', 'lli', 'llu', 'f', 'lf');
@ctypes   = ('char', 'unsigned char', 'char', 'short', 'unsigned short', 'int', 'unsigned',
             'long long', 'long long unsigned', 'float', 'double');
@uctypes  = ('unsigned char', 'unsigned char', 'unsigned char', 'unsigned short', 'unsigned short', 'unsigned', 'unsigned',
             'long long unsigned', 'long long unsigned', 'float', 'double');

$len1 = @nctypes;

$fname = $fname0;
$fname =~ s/\.in\.c/.c/;
open out1, ">$fname"; # functions.c
if ($i==0) {
    print out1 "#include <string.h>\n#include <nctietue3.h>\n#include \"colormaps.h\"\n\n"; }

open in, "<$fname0"; # functions.in.c
for($j=0; $j<$len1; $j++) {
    $a = "autogenerated/$fname0";
    $a =~ s/\.in\.c/_@nctypes[$j].c/;

    open out2, ">$a"; # autogenerated/functions_NC_TYPE.c
    seek in, 0, 0;
    while(<in>) {
	$_ =~ s/\@nctype/@nctypes[$j]/g;
	$_ =~ s/\@form/@formats[$j]/g;
	$_ =~ s/\@ctype/@ctypes[$j]/g;
	$_ =~ s/\@uctype/@uctypes[$j]/g;
	print out2 $_;
    }
    close out2;

    print out1 "#include \"$a\"\n";
}

print out1 "\n#include \"function_wrappers.c\"\n";

close out1;
close in;
